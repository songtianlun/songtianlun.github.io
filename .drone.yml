kind: pipeline
type: docker
name: default

clone:
  depth: 50
  tags: true
  skip_verify: true

steps:
- name: submodules
  image: alpine/git
  commands:
#    - mkdir -p ~/.ssh
#    - ssh-keyscan -p 2022 -t rsa git.frytea.local >> ~/.ssh/known_hosts
     - cat <<EOF > ${HOME}/.netrc
       machine ${DRONE_NETRC_MACHINE}
       login ${DRONE_NETRC_USERNAME}
       password ${DRONE_NETRC_PASSWORD}
       EOF
#    - ssh-keyscan -H ${DRONE_NETRC_MACHINE} > /etc/ssh/ssh_known_hosts 2> /dev/null
     - git submodule update --init --recursive
- name: build
  image: plugins/hugo
  settings:
    hugo_version: 0.85.0
    validate: true