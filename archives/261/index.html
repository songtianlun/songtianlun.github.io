<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>裸金属服务器kvm虚拟化安装win10 | Frytea</title><meta name=keywords content="KVM"><meta name=description content="受够了小鸡的各种卡顿以及各种套路，就想要一只&#34;大鸡&#34;，趁着双十一的余热购入达州创梦网络的江苏宿迁高防裸金属服务器（一种集"><meta name=author content="Tianlun Song"><link rel=canonical href=https://www.frytea.com/archives/261/><meta name=yandex-verification content="73b1a797f62c0e98"><meta name=baidu-site-verification content="code-gnOrbP1RyC"><meta name=baidu_union_verify content="4c552c344295cb984c46ebe74962b067"><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/satouriko/LxgwWenKai_Webfonts@v1.101/dist/LXGWWenKai-Light.css><link crossorigin=anonymous href=/assets/css/stylesheet.min.c5e9b9a30a68c57670e00490fcbe42331248183e26454c2aabee667e9e16f616.css integrity="sha256-xem5owpoxXZw4ASQ/L5CMxJIGD4mRUwqq+5mfp4W9hY=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://www.frytea.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.frytea.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.frytea.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.frytea.com/apple-touch-icon.png><link rel=mask-icon href=https://www.frytea.com/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.85.0"><link rel=manifest href=/manifest.json><script type=text/javascript>function downloadJSAtOnload(){var a=document.createElement("script");a.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7296634171837358",document.body.appendChild(a)}window.addEventListener?window.addEventListener("load",downloadJSAtOnload,!1):window.attachEvent?window.attachEvent("onload",downloadJSAtOnload):window.onload=downloadJSAtOnload</script><script async defer data-website-id=3d947a98-2774-46b0-805f-fe2e4877a1d7 src=https://umami.frytea.com/script.js></script><script async src=https://www.frytea.com/js/busuanzi.pure.mini.js></script><link rel=stylesheet href=/libs/font-awesome-4.7.0/css/font-awesome.min.css><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://lf6-cdn-tos.bytecdntp.com/cdn/expire-4-w/mermaid/8.14.0/mermaid.min.js crossorigin=anonymous></script><script>const config={startOnLoad:!0,theme:'forest',themeVariables:{lineColor:"#fafafa"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(void 0,document.querySelectorAll('.language-mermaid'))}</script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?c49e2f5be5e009382be07455c33b1394",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-136094326-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="裸金属服务器kvm虚拟化安装win10"><meta property="og:description" content="受够了小鸡的各种卡顿以及各种套路，就想要一只&#34;大鸡&#34;，趁着双十一的余热购入达州创梦网络的江苏宿迁高防裸金属服务器（一种集"><meta property="og:type" content="article"><meta property="og:url" content="https://www.frytea.com/archives/261/"><meta property="og:image" content="https://www.frytea.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="archives"><meta property="article:published_time" content="2019-11-21T16:39:00+00:00"><meta property="article:modified_time" content="2019-11-21T16:39:00+00:00"><meta property="og:site_name" content="Frytea"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.frytea.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="裸金属服务器kvm虚拟化安装win10"><meta name=twitter:description content="受够了小鸡的各种卡顿以及各种套路，就想要一只&#34;大鸡&#34;，趁着双十一的余热购入达州创梦网络的江苏宿迁高防裸金属服务器（一种集"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Archives","item":"https://www.frytea.com/archives/"},{"@type":"ListItem","position":2,"name":"裸金属服务器kvm虚拟化安装win10","item":"https://www.frytea.com/archives/261/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"裸金属服务器kvm虚拟化安装win10","name":"裸金属服务器kvm虚拟化安装win10","description":"受够了小鸡的各种卡顿以及各种套路，就想要一只\u0026quot;大鸡\u0026quot;，趁着双十一的余热购入达州创梦网络的江苏宿迁高防裸金属服务器（一种集","keywords":["KVM"],"articleBody":"受够了小鸡的各种卡顿以及各种套路，就想要一只\"大鸡\"，趁着双十一的余热购入达州创梦网络的江苏宿迁高防裸金属服务器（一种集合了虚拟机和物理机优点的产物），本人没有使用或配置过独立服务器，不过多评价。但和普通的 VPS 相比，裸金属服务器属于物理服务器，我的数据和其他用户数据做到了物理隔离，同时服务器本身是支持二次虚拟化的。\n裸金属服务器的购入主要为满足自己下列几点需求：\n 较高性能低延迟的 Windows 桌面工作台 高防大容量的 Linux 网站服务器  当服务器交付完成，第一步就是对它进行虚拟化！这一台主机有下列硬件资源：\n CPU model : Intel(R) Xeon(R) CPU L5630 @ 2.13GHz Number of cores : 16 Thread(s) per core: 2 Core(s) per socket: 4 Socket(s): 2 CPU frequency : 1600.000 MHz Total size of Disk : 932.0 GB (7.1 GB Used) OS : CentOS 7.5.1804 Arch : x86_64 (64 Bit) Kernel : 3.10.0-862.el7.x86_64  目前计划在宿主机上虚拟化一台 win10 和一台 Debian，其中为 win10 分配 6C/8G/100GB的硬件资源。下面就记录一下在 CentOS 7.5环境下使用 KVM架构虚拟化安装 Win10 Pro的过程。\n环境准备 以下为摘录的部分关于 KVM 的描述，运行描述后的命令以完成 KVM 的环境准备。\nKVM架构：\nKVM 是基于虚拟化扩展（Intel VT 或者 AMD-V）的 X86 硬件的开源的 Linux 原生的全虚拟化解决方案。KVM 中，虚拟机被实现为常规的 Linux 进程，由标准 Linux 调度程序进行调度； 虚机的每个虚拟 CPU 被实现为一个常规的 Linux 进程。这使得 KMV 能够使用 Linux 内核的已有功能。 但是，KVM 本身不执行任何硬件模拟，需要客户空间程序通过 /dev/kvm 接口设置一个客户机虚拟服务器的地址空间，向它提供模拟的 I/O，并将它的视频显示映射回宿主的显示屏。 目前这个应用程序是 QEMU。\nKVM 工具集合\n libvirt：操作和管理KVM虚机的虚拟化 API，使用 C 语言编写，可以由 Python,Ruby, Perl, PHP, Java 等语言调用。可以操作包括 KVM，vmware，XEN，Hyper-v, LXC 等 Hypervisor。 Virsh：基于 libvirt 的 命令行工具 （CLI） Virt-Manager：基于 libvirt 的 GUI 工具 virt-v2v：虚机格式迁移工具 virt-* 工具：包括 Virt-install （创建KVM虚机的命令行工具）， Virt-viewer （连接到虚机屏幕的工具），Virt-clone（虚机克隆工具），virt-top 等 sVirt：安全工具  （⚠️注：\"$\" 后代表一条命令，没有该符号的行代表运行结果，\"\"结尾代表多行命令，请注意）\n$ yum -y install vim lrzsz $ cat /etc/centos-release CentOS Linux release 7.4.1708 (Core) $ uname -a Linux bogon 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux $ yum -y install qemu-kvm virt-manager python-virtinst qemu-kvm-tools libvirt virt-install libvirt-python\t# 其中第2-4个是KVM的管理工具 $ lsmod |grep kvm # 确定是否正确加载kvm模块 $ reboot\t# 重启后下面的命令才管用，否则会出错 $ systemctl enable libvirtd　# 将libvitd服务加入开机自启 $ systemctl start libvirtd\t# 启动libvitd服务 $ systemctl status libvirtd\t# 查看libvitd服务的状态 $ virsh -c qemu:///system list （或者virsh list）　# 如出现下面的信息则表明kvm成功安装 Id 名称 状态 ---------------------------------------------------- 准备资源 经过一番搜索和实践，创建一台虚拟机需要的资源清单如下：\n 桥接网卡(br0) 虚拟磁盘文件(WASU_AF.qcow2) virtio驱动(virtio-win-0.1.126_amd64.vfd) windows 10镜像(Win10_1903_V2_Chinese_Simplified_x64.iso)  需下载的资源 在进行下面的操作前先说需要下载的资源，可以在进行下列操作前先将这些资源下载好并整理好，创建虚拟机需要指定以上资源的路径，因此建议根据需求将需要的文件归类。\n下面先来说说 virtio驱动， kvm 的虚拟硬盘的模式是virtio，virtio的性能和稳定性上佳， 但是windows安装盘是找不到virtio模式的虚拟硬盘的， 因此必须要加载virtio的磁盘驱动。驱动可以在安装前加载或是直接使用包含了驱动的镜像（第三方），此外还可以在安装时加载，本次安装就是在安装时加载驱动，将驱动作为磁盘进行加载，因此首先需要下载驱动，创建虚拟机时这个驱动将会和镜像一起加载。\nVirtio驱动官方渠道: https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/\n根据需要选择，在这里我选择 virtio-win-0.1.173_amd64.vfd wget https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.173-2/virtio-win-0.1.173_amd64.vfd\nwindows10镜像不必多说，网上途径很多，在这里我选择通过官方渠道下载：\n下载 Windows 10 光盘映像（ISO 文件） : https://www.microsoft.com/zh-cn/software-download/windows10ISO\n准备好以上资源，接下来进行下面的步骤。\n网卡配置 KVM 客户机网络连接有三种方式：\n host-only：虚拟机使用的是当前计算机中的虚拟网卡，如VMWare Network Adaptor（这是VMWare的），仅主机模式，意思就是将所有的虚拟机组成一个局域网，不能和外界通信，不能访问Internet，其他主机也不能访问虚拟主机，安全性高，只能与本台真实机通信。 NAT方式（网络地址转换模式）：让虚拟机访问主机、互联网或本地网络上的资源的简单方法，但是不能从网络或其他的客户机访问客户机，性能上也需要大的调整。 Bridge方式「虚拟网桥（Virtual Bridge）」：这网络模式下客户机与宿主机处于同一网络环境，类似于一台真实的宿主机，直接访问网络资源，设置好后客户机与互联网，客户机与主机之间的通信都很容易。   2019.11.22更新\n实际配置发现网桥可以使虚拟机和物理机处于同一级别，但是我并不知道我的服务器在当前局域网中的配置，此外我仅有一个ip，因此使用网桥并不合适（不知道理解的对不对，这是我目前的理解，后续有误再更）。因此这里修改为采用 Nat 方式配置网络。\n开启 IPV4转发:\nvim /etc/sysctl.conf\n把 net.ipv4.ip_forward = 1 值原来是 0, 改成 1\n执行命令 sysctl -p 使配置生效.\nKVM虚拟机Nat方式上网：\nvirsh net-list\n查看当前活跃的网络，可以看到一个default网络，这个就是安装 KVM 后自带的一个默认的Nat网络了。后面我们直接使用这个网络进行配置。\n 注：如果还没有进行bridge配置，继续下面的操作（磁盘配置）就好，如果已经使用 bridge 安装了虚拟机，可以按照以下的步骤修改/etc/libvirt/qemu/下的同名xml文件。\n配置 bridge 的虚拟机XML配置文件中的网络配置部分形如：\n\r只需将其中的 bridge 修改为 network 并修改网卡为 default即可，最后重启libvirt服务使之生效，systemctl restart libvirtd ，再启动虚拟机即可。\n 再次更新：如果需要使用外网访问 虚拟机，就需要使用 nat端口转发，在配置端口转发前需要先配置网桥，此时的网桥不是给虚拟机使用，而是为了端口转发。\n配置过程中的物理机默认网卡信息可以在 /etc/sysconfig/network-scripts/ifcfg-eth0文件中看到(vim /etc/sysconfig/network-scripts/ifcfg-eth0)，从上述文件中获取到物理机的 IPADDR, NETMASK, GATEWAY，之后在/etc/sysconfig/network-scripts/目录下新建ifcfg-br0文件(vim /etc/sysconfig/network-scripts/ifcfg-br0)，写入以下信息（⚠️ 实际操作时请自动删除注释部分）：\nBOOTPROTO=static DEVICE=br0 TYPE=Bridge NM_CONTROLLED=no IPADDR=112.3.24.154 //设置为物理机所占有的ip地址 NETMASK=255.255.255.0 GATEWAY=112.3.24.1\n配置好桥接网卡后还需要到默认网卡中添加这个桥接网卡，修改默认网卡(vim /etc/sysconfig/network-scripts/ifcfg-eth0)，既在最后加入一行BRIDGE=br0 ，修改后的默认网卡文件文本如下： DEVICE=eth0 ONBOOT=yes TYPE=Ethernet BOOTPROTO=static PEERDNS=no NM_CONTROLLED=no IPADDR=112.3.24.154 NETMASK=255.255.255.0 GATEWAY=112.3.24.1 MACADDR=00:26:6c:f5:01:18 BRIDGE=br0\n关闭 NetworkManager \n\r$ systemctl stop NetworkManager\r$ systemctl disable NetworkManager\r重启网络服务\nservice network restart\n通过brctl命令查看网桥状态\nvnet0 virbr0 8000.5254009b1724 yevirbr0-nic ```\r### 虚拟磁盘配置\r使用如下命令在需要的位置创建虚拟磁盘，根据需要调整名称和大小.\r$ qemu-img create -f qcow2 win10.qcow2 100G\n\r## 安装虚拟机\r准备好所需资料，就差临门一脚，运行如下命令就可以完成虚拟机的创建，请根据自己的实际情况对每一行的内容进行修改，在此有一些备注：\r1. 虚拟机名称 `name` 必须唯一\r2. 分配给虚拟机的vCPU个数由sockets、cores、threads三个参数的乘积来控制，sockets指代CPU插槽数目，cores指代每个插槽芯片的核心数，threads指代那个核心的超线程，如下所示创建的虚拟机共有6个逻辑cpu (cpu 情况可以使用这个命令: `lscpu`)。\r3. listen指代的是虚拟机的VNC监听接口，默认是localhost，0:0:0:0指带所有的IPv4接口，::指代所有接口，包括IPv4和IPv6。\r```bash\rlouie@ubuntu:~$ virt-install \\\r--name Frytea-Win10 \\\r--memory 8192 \\\r--vcpus sockets=1,cores=3,threads=2 \\\r--cdrom=/srv/kvm/win10/Win10_1909_Chinese_Simplified_x64.iso \\\r--os-type=windows \\\r--os-variant=auto \\\r--disk /srv/kvm/win10/Win10.qcow2,bus=virtio,size=100 \\\r--disk /srv/kvm/win10/virtio-win-0.1.173_amd64.vfd,device=floppy \\\r--network bridge=default,model=virtio \\\r--graphics vnc,password=kvmwin10,listen=::,port=5910 \\\r--hvm \\\r--autostart \\\r--virt-type kvm\rWARNING Unable to connect to graphical console: virt-viewer not installed. Please install the 'virt-viewer' package.\rWARNING No console to launch for the guest, defaulting to --wait -1\rStarting install...\rAllocating 'win10.qcow | 100 GB 00:00 ERROR Cannot get interface MTU on 'default': No such device\rRemoving disk 'win10.q | 0 B 00:00 Domain installation does not appear to have been successful.\rIf it was, you can restart your domain by running:\rvirsh --connect qemu:///system start Frytea-Win10\rotherwise, please restart your installation.\r操作：\n# 查看虚拟机运行状态\r$ virsh list\rId Name State\r----------------------------------------------------\r3 Frytea-Win10 running\r# 查看所有\r$ virsh list -l\r# 关机\r$ sudo virsh shutdown Frytea-Win10\r# 开机\r$ sudo virsh start Frytea-Win10\r# 重启\r$ sudo virsh reboot Frytea-Win10\r# 暂停（挂起）\r$ sudo virsh suspend Frytea-Win10\r# 删除(强行关机)\r$ sudo virsh destroy DELL_STORAGE\r# 要想彻底删除一个虚拟机需要将其xml文件一并删除，即删除/etc/libvirt/qemu/下的同名xml文件.\r# 移除虚拟机，虚拟机处于关闭状态后还可以启动，但是被该指令删除后不能启动。在虚拟机处于Running状态时，调用该指令，该指令暂时不生效，但是当虚拟机被关闭后，该指令生效移除该虚拟机，也可以在该指令生效之前调用define+TestKVM.xml取消该指令\r$ virsh undefine DomainName\r# 重启libvirt服务\r$ systemctl restart libvirtd\r安装 Win10 执行到这个阶段如果一切顺利就可以进入 win10 安装了，使用 VNC客户端连接到虚拟机，其中地址为宿主机 ip端口为命令中配置的5910，密码为kvmwin10。\nVNC（Virtual Network Computing），为一种使用RFB协议的屏幕画面分享及远程操作软件。此软件借由网络，可发送键盘与鼠标的动作及即时的屏幕画面。 VNC与操作系统无关，因此可跨平台使用，例如可用Windows连线到某Linux的电脑，反之亦同。甚至在没有安装客户端程序的电脑中，只要有支持JAVA的浏览器，也可使用。\nVNC 是独立于操作系统而存在的，因此当 ssh/RDP 找不到服务器时，就可以进入 VNC 进行维护。网上有一些人会将 VNC和RDP放在一起做对比，个人认为这是没有什么可比性的，因为 RDP 是需要 windows 服务启动后才会随之启动，而 VNC 与操作系统无关，比如本次安装就可以看出 VNC 是可以看到 Windows 的整个安装过程的，如果没有这个想要为服务器远程安装系统就是一抹黑了。\n安装win10需要提供激活码，在这里贴上几个来自互联网分享的激活码，截止到2019年6月：\n六月最新win10永久激活key密钥攻略(大集合)：\rOperating system edition(操作系统版本)：KMS Client Setup Key(KMS客户端安装序列号)\rWindows 10 Professional(专业版)：W269N-WFGWX-YVC9B-4J6C9-T83GX\rWindows 10 Professional N(专业版N)：MH37W-N47XK-V7XM9-C7227-GCQG9\rWindows 10 Enterprise(企业版)：NPPR9-FWDCX-D2C8J-H872K-2YT43\rWindows 10 Enterprise N(企业版N)：DPH2V-TTNVB-4X9Q3-TJR4H-KHJW4\rWindows 10 Education(教育版)：NW6C2-QMPVW-D7KKK-3GKT6-VCFB2\rWindows 10 Education N(教育版N)：2WH4N-8QGBV-H22JP-CT43Q-MDWWJ 全球主机论坛的 gyld大佬分享了一个 win10 pro 的激活码，本人 2019.11.22 日亲测直接激活。激活码: 9HTXD-BWVFH-PP4JD-2V43X-JCPJP\n本文内容为多方探索后实践验证，最终整理的产物，在最后列出参考文献，本文若有描述不清楚的地方可以到参考文献中试试。\nNat 端口转发 \r[root@localhost ~]# ifconfig\r...\rvirbr0: flags=4163 mtu 1500\rinet 192.168.122.1 netmask 255.255.255.0 broadcast 192.168.122.255\rether 52:54:00:a0:ea:03 txqueuelen 1000 (Ethernet)\rRX packets 544450 bytes 27198927 (25.9 MiB)\rRX errors 0 dropped 0 overruns 0 frame 0\rTX packets 593033 bytes 1680545079 (1.5 GiB)\rTX errors 0 dropped 0 overruns 0 carrier 0 collisions 0\r...\r通过上图，我们可以看出网卡virbr0就是NAT方式连接网络时，所使用到的网卡。\n除此之外我们还可以通过配置文件，来查看NAT方式的DHCP地址池。该配置文件为：/etc/libvirt/qemu/networks/default.xml。如下:\n\rdefault\r1ea78a7d-4776-4e7e-99f1-aab6b9cba8b2\r\r\r\r\r我们可以看出，目前NAT使用的IP地址池是192.168.122.2-192.168.122.254，网关为192.168.122.1，子网掩码为255.255.255.0。\n下面开始配置 nat 端口转发 , 宿主机的公网 ip 为 112.3.24.154 VM的IP为192.168.122.2，现在我要求通过访问KVM的 3389 端口访问VM的 3389 端口。\n开启KVM服务器的IP转发功能。编辑/etc/stsctl.conf文件，把其中的net.ipv4.ip_forward = 0修为net.ipv4.ip_forward = 1，如下：\n开启KVM服务器的IPtables的转发功能，使用如下命令：\niptables -t nat -A POSTROUTING -o br0 -j MASQUERADE\n注意该命令中的网卡时br0，而不是eth0。转发许可：\niptables -I FORWARD -o virbr0 -d 192.168.122.2 -j ACCEPT\n需要注意的是 , 这里的 192.168.122.111 是你虚拟机的 IP, 如果你需要端口转发 , 建议在虚拟机里面设置成固定 IP, 而不是 dhcp 获取 . 否则你虚拟机 ip 变了就又连不上了 .\n下面是一个代码段 , 有要开放的端口都可以依次设置 . 比如要开放 3389, 那么 iptables 命令就是 : 192.168.122.111 是虚拟机的 ip\n\r$ iptables -A INPUT -p tcp --dport 3389 -j ACCEPT\r$ iptables -t nat -A PREROUTING -p tcp -m tcp -i br0 --dport 3389 -j DNAT --to-destination 192.168.122.2:3389\r$ service iptables save\r$ service iptables restart\r执行这个命令的时候有时候可能会报错：The service command supports only basic LSB actions (start, stop, restart, try-restart, reload, force-reload, status). For other actions, please try to use systemctl.\n这是因为没有安装iptables服务，直接使用yum安装iptables服务再执行未执行完的命令即可.\nyum install iptables-services\r执行如下命令（老版本命令为：service iptables on），设置iptables开机自启\nsystemctl enable iptables.service\r需关闭firewalld防火墙\n$ systemctl stop firewalld.service\r$ systemctl disable firewalld.service\r补充，为宿主机安装桌面系统 Linux系统在服务器上一般都直接最小化安装，是不安装图形界面的，但是有时候，有一些特殊情况，需要使用图形界面，下面是安装 GNOME 桌面的步骤。\n$ yum grouplist\r# 列出的组列表里有GNOME Desktop。安装之\r$ yum groupinstall -y \"GNOME Desktop\"\r# 安装完成后，修改默认启动方式为图形化界面\r$ systemctl set-default graphical.target //设置成图形模式\r# 如果要换回来\r$ systemctl set-default multi-user.target //设置成命令模式\r# 然后重启即可，或者startx开启图形界面。第一次启动可能时间会长一点，耐心等待即可。\rKVM 调整内存 ps：调小内存可以动态实现，不用关机\n1、产看当前配置：\n$ virsh dominfo vm | grep memory Max memory: 8388608 KiB\rUsed memory: 4194304 KiB\r2、设置虚拟机内存： 512M\n$ virsh setmem vm 524288\rKVM 调整cpu 1、关闭虚机\n$ virsh shutdown vm | virsh destroy vm\r2、编辑虚拟机配置文件，调整\n#virsh edit vm\r8388608\r8388608\r4\r3、从配置文件启动虚机\n$ virsh create /etc/libvirt/qemu/vim.xml\r4、查看当前内存大小\n$ virsh dominfo vm | grep memory Max memory: 8388608 KiB\rUsed memory: 8388608 KiB\r5、验证：\n$ virsh dominfo vm\r参考文献  Centos 7 KVM安装win10 KVM 安装windows 虚拟机 KVM安装windows kvm虚拟机的桥接网络配置 2019年6月win10免费激活密钥 最新win10激活码序列号 LINUX查看CPU个数/多核/多线程的查看 VNC - WikiPedia 配置KVM虚拟机的网络，Bridge和Nat方式 教程:CentOS服务器安装windows虚拟机(NAT版),解决KVM中windows10安装蓝屏的问题 谁的小店有WIN10专业版的激活码呀？ - hostloc 烂泥：KVM使用NAT联网并为VM配置iptables端口转发 CentOS配置iptables规则并使其永久生效 Centos7 安装VNC实现远程桌面 kvm调整配置cpu、内存  ","wordCount":"6021","inLanguage":"zh","datePublished":"2019-11-21T16:39:00Z","dateModified":"2019-11-21T16:39:00Z","author":{"@type":"Person","name":"Tianlun Song"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.frytea.com/archives/261/"},"publisher":{"@type":"Organization","name":"Frytea","logo":{"@type":"ImageObject","url":"https://www.frytea.com/favicon.ico"}}}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://www.frytea.com/ accesskey=h title="🏡 Frytea (Alt + H)">🏡 Frytea</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.frytea.com/tags/ title="🏷️ 标签"><span>🏷️ 标签</span></a></li><li><a href=https://www.frytea.com/search/ title="🔍 索引 (Alt + /)" accesskey=/><span>🔍 索引</span></a></li><li><a href=https://www.frytea.com/friends title="🧑‍🤝‍🧑 友链"><span>🧑‍🤝‍🧑 友链</span></a></li><li><a href=https://www.travellings.cn/go.html title=🚇><span>🚇</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.frytea.com/>主页</a>&nbsp;»&nbsp;<a href=https://www.frytea.com/archives/>Archives</a></div><h1 class=post-title><a href=https://www.frytea.com/archives/261/>裸金属服务器kvm虚拟化安装win10</a></h1><div class=post-meta>November 21, 2019&nbsp;·&nbsp;13 分钟&nbsp;·&nbsp;6021 字&nbsp;·&nbsp;Tianlun Song&nbsp;|&nbsp;<a href=https://github.com/songtianlun/songtianlun.github.io/edit/main/content/archives/%e8%a3%b8%e9%87%91%e5%b1%9e%e6%9c%8d%e5%8a%a1%e5%99%a8kvm%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%89%e8%a3%85win10.md rel="noopener noreferrer" target=_blank>PR</a>
<span>| <span class=waline-pageview-count data-path=/archives/261/><i class="fa fa-spinner fa-spin"></i></span> Hits</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87 aria-label=环境准备>环境准备</a></li><li><a href=#%e5%87%86%e5%a4%87%e8%b5%84%e6%ba%90 aria-label=准备资源>准备资源</a><ul><li><a href=#%e9%9c%80%e4%b8%8b%e8%bd%bd%e7%9a%84%e8%b5%84%e6%ba%90 aria-label=需下载的资源>需下载的资源</a></li><li><a href=#%e7%bd%91%e5%8d%a1%e9%85%8d%e7%bd%ae aria-label=网卡配置>网卡配置</a></li></ul></li><li><a href=#%e5%ae%89%e8%a3%85-win10 aria-label="安装 Win10">安装 Win10</a></li><li><a href=#nat-%e7%ab%af%e5%8f%a3%e8%bd%ac%e5%8f%91 aria-label="Nat 端口转发">Nat 端口转发</a></li><li><a href=#%e8%a1%a5%e5%85%85%e4%b8%ba%e5%ae%bf%e4%b8%bb%e6%9c%ba%e5%ae%89%e8%a3%85%e6%a1%8c%e9%9d%a2%e7%b3%bb%e7%bb%9f aria-label=补充，为宿主机安装桌面系统>补充，为宿主机安装桌面系统</a></li><li><a href=#kvm-%e8%b0%83%e6%95%b4%e5%86%85%e5%ad%98 aria-label="KVM 调整内存">KVM 调整内存</a></li><li><a href=#kvm-%e8%b0%83%e6%95%b4cpu aria-label="KVM 调整cpu">KVM 调整cpu</a></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae aria-label=参考文献>参考文献</a></li></ul></div><div><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7296634171837358 data-ad-slot=9161921641 data-ad-format=auto data-full-width-responsive=true></ins></div><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></details></div><div class=post-content><blockquote style=margin-top:8px><p style=text-align:center;text-indent:0><a href=https://www.frytea.com/archives/261/>本文</a>
首发于
<a href=https://www.frytea.com/>🌱 煎茶</a>，
<a href=/disclaimer/>转载</a> 请注明
<a href=https://www.frytea.com/archives/261/>来源</a>。</p></blockquote><p>受够了小鸡的各种卡顿以及各种套路，就想要一只"大鸡"，趁着双十一的余热购入<a href=https://www.dzisp.cn>达州创梦网络</a>的<a href=https://www.dzisp.cn/baremetal/>江苏宿迁高防裸金属服务器</a>（一种集合了虚拟机和物理机优点的产物），本人没有使用或配置过独立服务器，不过多评价。但和普通的 VPS 相比，裸金属服务器属于物理服务器，我的数据和其他用户数据做到了物理隔离，同时服务器本身是支持二次虚拟化的。</p><p>裸金属服务器的购入主要为满足自己下列几点需求：</p><ul><li>较高性能低延迟的 Windows 桌面工作台</li><li>高防大容量的 Linux 网站服务器</li></ul><p>当服务器交付完成，第一步就是对它进行<strong>虚拟化</strong>！这一台主机有下列硬件资源：</p><ul><li>CPU model : Intel(R) Xeon(R) CPU L5630 @ 2.13GHz</li><li>Number of cores : 16</li><li>Thread(s) per core: 2</li><li>Core(s) per socket: 4</li><li>Socket(s): 2</li><li>CPU frequency : 1600.000 MHz</li><li>Total size of Disk : 932.0 GB (7.1 GB Used)</li><li>OS : CentOS 7.5.1804</li><li>Arch : x86_64 (64 Bit)</li><li>Kernel : 3.10.0-862.el7.x86_64</li></ul><p>目前计划在宿主机上虚拟化一台 <code>win10</code> 和一台 <code>Debian</code>，其中为 <code>win10</code> 分配 <code>6C/8G/100GB</code>的硬件资源。下面就记录一下在 <code>CentOS 7.5</code>环境下使用 <code>KVM</code>架构虚拟化安装 <code>Win10 Pro</code>的过程。</p><h2 id=环境准备>环境准备<a hidden class=anchor aria-hidden=true href=#环境准备>#</a></h2><p>以下为摘录的部分关于 <code>KVM</code> 的描述，运行描述后的命令以完成 <code>KVM</code> 的环境准备。</p><p>KVM架构：</p><p>KVM 是基于虚拟化扩展（Intel VT 或者 AMD-V）的 X86 硬件的开源的 Linux 原生的全虚拟化解决方案。KVM 中，虚拟机被实现为常规的 Linux 进程，由标准 Linux 调度程序进行调度；
虚机的每个虚拟 CPU 被实现为一个常规的 Linux 进程。这使得 KMV 能够使用 Linux 内核的已有功能。
但是，KVM 本身不执行任何硬件模拟，需要客户空间程序通过 /dev/kvm 接口设置一个客户机虚拟服务器的地址空间，向它提供模拟的 I/O，并将它的视频显示映射回宿主的显示屏。
目前这个应用程序是 QEMU。</p><p>KVM 工具集合</p><ul><li>libvirt：操作和管理KVM虚机的虚拟化 API，使用 C 语言编写，可以由 Python,Ruby, Perl, PHP, Java 等语言调用。可以操作包括 KVM，vmware，XEN，Hyper-v, LXC 等 Hypervisor。</li><li>Virsh：基于 libvirt 的 命令行工具 （CLI）</li><li>Virt-Manager：基于 libvirt 的 GUI 工具</li><li>virt-v2v：虚机格式迁移工具</li><li>virt-* 工具：包括 Virt-install （创建KVM虚机的命令行工具）， Virt-viewer （连接到虚机屏幕的工具），Virt-clone（虚机克隆工具），virt-top 等</li><li>sVirt：安全工具</li></ul><p>（⚠️注："$" 后代表一条命令，没有该符号的行代表运行结果，""结尾代表多行命令，请注意）</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ yum -y install vim lrzsz
$ cat /etc/centos-release
　　CentOS Linux release 7.4.1708 <span style=color:#f92672>(</span>Core<span style=color:#f92672>)</span> 
$ uname -a
　　Linux bogon 3.10.0-693.el7.x86_64 <span style=color:#75715e>#1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span>

$ yum -y install qemu-kvm virt-manager python-virtinst qemu-kvm-tools libvirt virt-install libvirt-python	　　　　	<span style=color:#75715e># 其中第2-4个是KVM的管理工具</span>
$ lsmod |grep kvm 　　　　 　　 <span style=color:#75715e># 确定是否正确加载kvm模块</span>
$ reboot	　　　　　　　　　　  	<span style=color:#75715e># 重启后下面的命令才管用，否则会出错</span>
$ systemctl enable libvirtd　　     <span style=color:#75715e># 将libvitd服务加入开机自启</span>
$ systemctl start libvirtd	　　　　	<span style=color:#75715e># 启动libvitd服务</span>
$ systemctl status libvirtd	　　　　	<span style=color:#75715e># 查看libvitd服务的状态</span>

$ virsh -c qemu:///system list （或者virsh  list）　　　　	<span style=color:#75715e># 如出现下面的信息则表明kvm成功安装</span>

Id 名称 　　　　　　　　 　　 状态
----------------------------------------------------
</code></pre></div><h2 id=准备资源>准备资源<a hidden class=anchor aria-hidden=true href=#准备资源>#</a></h2><p>经过一番搜索和实践，创建一台虚拟机需要的资源清单如下：</p><ul><li>桥接网卡(br0)</li><li>虚拟磁盘文件(WASU_AF.qcow2)</li><li>virtio驱动(virtio-win-0.1.126_amd64.vfd)</li><li>windows 10镜像(Win10_1903_V2_Chinese_Simplified_x64.iso)</li></ul><h3 id=需下载的资源>需下载的资源<a hidden class=anchor aria-hidden=true href=#需下载的资源>#</a></h3><p>在进行下面的操作前先说需要下载的资源，可以在进行下列操作前先将这些资源下载好并整理好，创建虚拟机需要指定以上资源的路径，因此建议根据需求将需要的文件归类。</p><p>下面先来说说 <code>virtio驱动</code>， kvm 的虚拟硬盘的模式是virtio，virtio的性能和稳定性上佳， 但是windows安装盘是找不到virtio模式的虚拟硬盘的， 因此必须要加载virtio的磁盘驱动。驱动可以在安装前加载或是直接使用包含了驱动的镜像（第三方），此外还可以在安装时加载，本次安装就是在安装时加载驱动，将驱动作为磁盘进行加载，因此首先需要下载驱动，创建虚拟机时这个驱动将会和镜像一起加载。</p><p>Virtio驱动官方渠道: <a href=https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/>https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/</a></p><p>根据需要选择，在这里我选择 <code>virtio-win-0.1.173_amd64.vfd</code>
<code>wget https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.173-2/virtio-win-0.1.173_amd64.vfd</code></p><p>windows10镜像不必多说，网上途径很多，在这里我选择通过官方渠道下载：</p><p>下载 Windows 10 光盘映像（ISO 文件） : <a href=https://www.microsoft.com/zh-cn/software-download/windows10ISO>https://www.microsoft.com/zh-cn/software-download/windows10ISO</a></p><p>准备好以上资源，接下来进行下面的步骤。</p><h3 id=网卡配置>网卡配置<a hidden class=anchor aria-hidden=true href=#网卡配置>#</a></h3><p>KVM 客户机网络连接有三种方式：</p><ul><li>host-only：虚拟机使用的是当前计算机中的虚拟网卡，如VMWare Network Adaptor（这是VMWare的），仅主机模式，意思就是将所有的虚拟机组成一个局域网，不能和外界通信，不能访问Internet，其他主机也不能访问虚拟主机，安全性高，只能与本台真实机通信。</li><li>NAT方式（网络地址转换模式）：让虚拟机访问主机、互联网或本地网络上的资源的简单方法，但是不能从网络或其他的客户机访问客户机，性能上也需要大的调整。</li><li>Bridge方式「虚拟网桥（Virtual Bridge）」：这网络模式下客户机与宿主机处于同一网络环境，类似于一台真实的宿主机，直接访问网络资源，设置好后客户机与互联网，客户机与主机之间的通信都很容易。</li></ul><hr><p>2019.11.22更新</p><p>实际配置发现网桥可以使虚拟机和物理机处于同一级别，但是我并不知道我的服务器在当前局域网中的配置，此外我仅有一个ip，因此使用网桥并不合适（不知道理解的对不对，这是我目前的理解，后续有误再更）。因此这里修改为采用 <code>Nat</code> 方式配置网络。</p><p>开启 <code>IPV4转发</code>:</p><p><code>vim /etc/sysctl.conf</code></p><p>把 <code>net.ipv4.ip_forward = 1</code> 值原来是 <code>0</code>, 改成 <code>1</code></p><p>执行命令 <code>sysctl -p</code> 使配置生效.</p><p>KVM虚拟机Nat方式上网：</p><p><code>virsh net-list</code></p><p>查看当前活跃的网络，可以看到一个<code>default</code>网络，这个就是安装 <code>KVM</code> 后自带的一个默认的Nat网络了。后面我们直接使用这个网络进行配置。</p><hr><p>注：如果还没有进行bridge配置，继续下面的操作（磁盘配置）就好，如果已经使用 bridge 安装了虚拟机，可以按照以下的步骤修改<code>/etc/libvirt/qemu/</code>下的同名<code>xml</code>文件。</p><p>配置 bridge 的虚拟机XML配置文件中的网络配置部分形如：</p><pre><code>&lt;interface type='bridge'&gt;
  &lt;mac address='52:54:00:84:e9:e1'/&gt;
  &lt;source bridge='br0'/&gt;
  &lt;model type='rtl8139'/&gt;
  &lt;address type='pci' domain='0x0000' bus='0x00' slot='0x03' function='0x0'/&gt;
&lt;/interface&gt;
</code></pre><p>只需将其中的 <code>bridge</code> 修改为 <code>network</code> 并修改网卡为 <code>default</code>即可，最后重启<code>libvirt</code>服务使之生效，<code>systemctl restart libvirtd</code> ，再启动虚拟机即可。</p><hr><p>再次更新：如果需要使用外网访问 虚拟机，就需要使用 nat端口转发，在配置端口转发前需要先配置网桥，此时的网桥不是给虚拟机使用，而是为了端口转发。</p><p>配置过程中的物理机默认网卡信息可以在 <code>/etc/sysconfig/network-scripts/ifcfg-eth0</code>文件中看到(<code>vim /etc/sysconfig/network-scripts/ifcfg-eth0</code>)，从上述文件中获取到物理机的 <code>IPADDR</code>, <code>NETMASK</code>, <code>GATEWAY</code>，之后在<code>/etc/sysconfig/network-scripts/</code>目录下新建<code>ifcfg-br0</code>文件(<code>vim /etc/sysconfig/network-scripts/ifcfg-br0</code>)，写入以下信息（⚠️ 实际操作时请自动删除注释部分）：</p><p><code>BOOTPROTO=static DEVICE=br0 TYPE=Bridge NM_CONTROLLED=no IPADDR=112.3.24.154 //设置为物理机所占有的ip地址 NETMASK=255.255.255.0 GATEWAY=112.3.24.1</code></p><p>配置好桥接网卡后还需要到默认网卡中添加这个桥接网卡，修改默认网卡(<code>vim /etc/sysconfig/network-scripts/ifcfg-eth0</code>)，既在最后加入一行<code>BRIDGE=br0</code> ，修改后的默认网卡文件文本如下： <code>DEVICE=eth0 ONBOOT=yes TYPE=Ethernet BOOTPROTO=static PEERDNS=no NM_CONTROLLED=no IPADDR=112.3.24.154 NETMASK=255.255.255.0 GATEWAY=112.3.24.1 MACADDR=00:26:6c:f5:01:18 BRIDGE=br0</code></p><p>关闭 <code>NetworkManager</code></p><pre><code>
$ systemctl stop NetworkManager

$ systemctl disable NetworkManager
</code></pre><p>重启网络服务</p><p><code>service network restart</code></p><p>通过brctl命令查看网桥状态</p><pre><code class=language-[root@localhost data-lang=[root@localhost>                                          vnet0 virbr0          8000.5254009b1724       yevirbr0-nic ```


### 虚拟磁盘配置

使用如下命令在需要的位置创建虚拟磁盘，根据需要调整名称和大小.

</code></pre><p>$ qemu-img create -f qcow2 win10.qcow2 100G</p><pre><code>
## 安装虚拟机

准备好所需资料，就差临门一脚，运行如下命令就可以完成虚拟机的创建，请根据自己的实际情况对每一行的内容进行修改，在此有一些备注：

1. 虚拟机名称 `name` 必须唯一
2. 分配给虚拟机的vCPU个数由sockets、cores、threads三个参数的乘积来控制，sockets指代CPU插槽数目，cores指代每个插槽芯片的核心数，threads指代那个核心的超线程，如下所示创建的虚拟机共有6个逻辑cpu (cpu 情况可以使用这个命令: `lscpu`)。
3. listen指代的是虚拟机的VNC监听接口，默认是localhost，0:0:0:0指带所有的IPv4接口，::指代所有接口，包括IPv4和IPv6。

```bash
louie@ubuntu:~$ virt-install \
--name Frytea-Win10 \
--memory 8192 \
--vcpus sockets=1,cores=3,threads=2 \
--cdrom=/srv/kvm/win10/Win10_1909_Chinese_Simplified_x64.iso \
--os-type=windows \
--os-variant=auto \
--disk /srv/kvm/win10/Win10.qcow2,bus=virtio,size=100 \
--disk /srv/kvm/win10/virtio-win-0.1.173_amd64.vfd,device=floppy \
--network bridge=default,model=virtio \
--graphics vnc,password=kvmwin10,listen=::,port=5910 \
--hvm \
--autostart \
--virt-type kvm

WARNING  Unable to connect to graphical console: virt-viewer not installed. Please install the 'virt-viewer' package.
WARNING  No console to launch for the guest, defaulting to --wait -1

Starting install...
Allocating 'win10.qcow | 100 GB  00:00     ERROR    Cannot get interface MTU on 'default': No such device
Removing disk 'win10.q |    0 B  00:00     Domain installation does not appear to have been successful.
If it was, you can restart your domain by running:
  virsh --connect qemu:///system start Frytea-Win10
otherwise, please restart your installation.

</code></pre><p>操作：</p><pre><code># 查看虚拟机运行状态
$ virsh list
 Id    Name                           State
----------------------------------------------------
 3     Frytea-Win10               running

# 查看所有
$ virsh list -l

# 关机
$ sudo virsh shutdown Frytea-Win10

# 开机
$ sudo virsh start Frytea-Win10

# 重启
$ sudo virsh reboot Frytea-Win10

# 暂停（挂起）
$ sudo virsh suspend Frytea-Win10

# 删除(强行关机)
$ sudo virsh destroy DELL_STORAGE
# 要想彻底删除一个虚拟机需要将其xml文件一并删除，即删除/etc/libvirt/qemu/下的同名xml文件.

# 移除虚拟机，虚拟机处于关闭状态后还可以启动，但是被该指令删除后不能启动。在虚拟机处于Running状态时，调用该指令，该指令暂时不生效，但是当虚拟机被关闭后，该指令生效移除该虚拟机，也可以在该指令生效之前调用define+TestKVM.xml取消该指令
$ virsh undefine DomainName

# 重启libvirt服务
$ systemctl restart libvirtd

</code></pre><h2 id=安装-win10>安装 Win10<a hidden class=anchor aria-hidden=true href=#安装-win10>#</a></h2><p>执行到这个阶段如果一切顺利就可以进入 <code>win10</code> 安装了，使用 <code>VNC</code>客户端连接到虚拟机，其中地址为宿主机 <code>ip</code>端口为命令中配置的<code>5910</code>，密码为<code>kvmwin10</code>。</p><p>VNC（Virtual Network Computing），为一种使用RFB协议的屏幕画面分享及远程操作软件。此软件借由网络，可发送键盘与鼠标的动作及即时的屏幕画面。
VNC与操作系统无关，因此可跨平台使用，例如可用Windows连线到某Linux的电脑，反之亦同。甚至在没有安装客户端程序的电脑中，只要有支持JAVA的浏览器，也可使用。</p><p>VNC 是独立于操作系统而存在的，因此当 ssh/RDP 找不到服务器时，就可以进入 VNC 进行维护。网上有一些人会将 VNC和RDP放在一起做对比，个人认为这是没有什么可比性的，因为 RDP 是需要 windows 服务启动后才会随之启动，而 VNC 与操作系统无关，比如本次安装就可以看出 VNC 是可以看到 Windows 的整个安装过程的，如果没有这个想要为服务器远程安装系统就是一抹黑了。</p><p>安装win10需要提供激活码，在这里贴上几个来自互联网分享的激活码，截止到2019年6月：</p><pre><code>六月最新win10永久激活key密钥攻略(大集合)：

Operating system edition(操作系统版本)：KMS Client Setup Key(KMS客户端安装序列号)

Windows 10 Professional(专业版)：W269N-WFGWX-YVC9B-4J6C9-T83GX

Windows 10 Professional N(专业版N)：MH37W-N47XK-V7XM9-C7227-GCQG9

Windows 10 Enterprise(企业版)：NPPR9-FWDCX-D2C8J-H872K-2YT43

Windows 10 Enterprise N(企业版N)：DPH2V-TTNVB-4X9Q3-TJR4H-KHJW4

Windows 10 Education(教育版)：NW6C2-QMPVW-D7KKK-3GKT6-VCFB2

Windows 10 Education N(教育版N)：2WH4N-8QGBV-H22JP-CT43Q-MDWWJ 
</code></pre><p><a href=https://www.hostloc.com/>全球主机论坛</a>的 <a href=https://www.hostloc.com/space-uid-28731.html>gyld</a>大佬分享了一个 <code>win10 pro</code> 的激活码，本人 2019.11.22 日亲测直接激活。激活码: <code>9HTXD-BWVFH-PP4JD-2V43X-JCPJP</code></p><p>本文内容为多方探索后实践验证，最终整理的产物，在最后列出参考文献，本文若有描述不清楚的地方可以到参考文献中试试。</p><h2 id=nat-端口转发>Nat 端口转发<a hidden class=anchor aria-hidden=true href=#nat-端口转发>#</a></h2><pre><code>
[root@localhost ~]# ifconfig
...

virbr0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        ether 52:54:00:a0:ea:03  txqueuelen 1000  (Ethernet)
        RX packets 544450  bytes 27198927 (25.9 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 593033  bytes 1680545079 (1.5 GiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

...
</code></pre><p>通过上图，我们可以看出网卡virbr0就是NAT方式连接网络时，所使用到的网卡。</p><p>除此之外我们还可以通过配置文件，来查看NAT方式的DHCP地址池。该配置文件为：/etc/libvirt/qemu/networks/default.xml。如下:</p><pre><code>&lt;network&gt;
  &lt;name&gt;default&lt;/name&gt;
  &lt;uuid&gt;1ea78a7d-4776-4e7e-99f1-aab6b9cba8b2&lt;/uuid&gt;
  &lt;forward mode='nat'/&gt;
  &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:a0:ea:03'/&gt;
  &lt;ip address='192.168.122.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
&lt;range start='192.168.122.2' end='192.168.122.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;
</code></pre><p>我们可以看出，目前<code>NAT</code>使用的IP地址池是<code>192.168.122.2-192.168.122.254</code>，网关为<code>192.168.122.1</code>，子网掩码为<code>255.255.255.0</code>。</p><p>下面开始配置 <code>nat</code> 端口转发 , 宿主机的公网 <code>ip</code> 为 <code>112.3.24.154</code> VM的IP为<code>192.168.122.2</code>，现在我要求通过访问KVM的 <code>3389</code> 端口访问VM的 <code>3389</code> 端口。</p><p>开启KVM服务器的IP转发功能。编辑/etc/stsctl.conf文件，把其中的net.ipv4.ip_forward = 0修为net.ipv4.ip_forward = 1，如下：</p><p>开启KVM服务器的IPtables的转发功能，使用如下命令：</p><p><code>iptables -t nat -A POSTROUTING -o br0 -j MASQUERADE</code></p><p>注意该命令中的网卡时br0，而不是eth0。转发许可：</p><p><code>iptables -I FORWARD -o virbr0 -d 192.168.122.2 -j ACCEPT</code></p><p>需要注意的是 , 这里的 192.168.122.111 是你虚拟机的 IP, 如果你需要端口转发 , 建议在虚拟机里面设置成固定 IP, 而不是 dhcp 获取 . 否则你虚拟机 ip 变了就又连不上了 .</p><p>下面是一个代码段 , 有要开放的端口都可以依次设置 . 比如要开放 3389, 那么 iptables 命令就是 : 192.168.122.111 是虚拟机的 ip</p><pre><code>
$ iptables -A INPUT -p tcp --dport 3389 -j ACCEPT
$ iptables -t nat -A PREROUTING -p tcp -m tcp -i br0 --dport 3389 -j DNAT --to-destination 192.168.122.2:3389

$ service iptables save
$ service iptables restart

</code></pre><p>执行这个命令的时候有时候可能会报错：<code>The service command supports only basic LSB actions (start, stop, restart, try-restart, reload, force-reload, status). For other actions, please try to use systemctl.</code></p><p>这是因为没有安装<code>iptables</code>服务，直接使用<code>yum</code>安装<code>iptables</code>服务再执行未执行完的命令即可.</p><pre><code>yum install iptables-services
</code></pre><p>执行如下命令（老版本命令为：<code>service iptables on</code>），设置<code>iptables</code>开机自启</p><pre><code>systemctl enable iptables.service
</code></pre><p>需关闭firewalld防火墙</p><pre><code>$ systemctl stop firewalld.service

$ systemctl disable firewalld.service
</code></pre><h2 id=补充为宿主机安装桌面系统>补充，为宿主机安装桌面系统<a hidden class=anchor aria-hidden=true href=#补充为宿主机安装桌面系统>#</a></h2><p>Linux系统在服务器上一般都直接最小化安装，是不安装图形界面的，但是有时候，有一些特殊情况，需要使用图形界面，下面是安装 <code>GNOME</code> 桌面的步骤。</p><pre><code>$ yum grouplist
# 列出的组列表里有GNOME Desktop。安装之
$ yum groupinstall -y &quot;GNOME Desktop&quot;
# 安装完成后，修改默认启动方式为图形化界面
$ systemctl set-default graphical.target  //设置成图形模式

# 如果要换回来
$ systemctl set-default multi-user.target  //设置成命令模式

# 然后重启即可，或者startx开启图形界面。第一次启动可能时间会长一点，耐心等待即可。
</code></pre><h2 id=kvm-调整内存>KVM 调整内存<a hidden class=anchor aria-hidden=true href=#kvm-调整内存>#</a></h2><p>ps：调小内存可以动态实现，不用关机</p><p>1、产看当前配置：</p><pre><code>$ virsh dominfo vm | grep memory    

Max memory: 8388608 KiB
Used memory: 4194304 KiB
</code></pre><p>2、设置虚拟机内存： 512M</p><pre><code>$ virsh setmem vm 524288
</code></pre><h2 id=kvm-调整cpu>KVM 调整cpu<a hidden class=anchor aria-hidden=true href=#kvm-调整cpu>#</a></h2><p>1、关闭虚机</p><pre><code>$ virsh shutdown vm    | virsh destroy vm
</code></pre><p>2、编辑虚拟机配置文件，调整</p><pre><code>#virsh edit vm

&lt;memory unit='KiB'&gt;8388608&lt;/memory&gt;
&lt;currentMemory unit='KiB'&gt;8388608&lt;/currentMemory&gt;
&lt;vcpu placement='static'&gt;4&lt;/vcpu&gt;
</code></pre><p>3、从配置文件启动虚机</p><pre><code>$ virsh create /etc/libvirt/qemu/vim.xml
</code></pre><p>4、查看当前内存大小</p><pre><code>$ virsh dominfo vm | grep memory        

Max memory: 8388608 KiB
Used memory: 8388608 KiB
</code></pre><p>5、验证：</p><pre><code>$ virsh dominfo vm
</code></pre><h2 id=参考文献>参考文献<a hidden class=anchor aria-hidden=true href=#参考文献>#</a></h2><ul><li><a href=https://www.cnblogs.com/smlile-you-me/p/8980599.html>Centos 7 KVM安装win10</a></li><li><a href=https://blog.csdn.net/nvd11/article/details/79323412>KVM 安装windows 虚拟机</a></li><li><a href=http://ylong.net.cn/KVM_install_windows.html>KVM安装windows</a></li><li><a href=https://my.oschina.net/amui/blog/851797>kvm虚拟机的桥接网络配置</a></li><li><a href=https://blog.csdn.net/erdfty/article/details/91511499>2019年6月win10免费激活密钥 最新win10激活码序列号</a></li><li><a href=http://smilejay.com/2011/03/linux_cpu_core_thread/>LINUX查看CPU个数/多核/多线程的查看</a></li><li><a href=https://zh.wikipedia.org/wiki/VNC>VNC - WikiPedia</a></li><li><a href=https://blog.csdn.net/jiuzuidongpo/article/details/44677565>配置KVM虚拟机的网络，Bridge和Nat方式</a></li><li><a href=https://www.91yun.co/archives/31611#>教程:CentOS服务器安装windows虚拟机(NAT版),解决KVM中windows10安装蓝屏的问题</a></li><li><a href=https://www.hostloc.com/thread-608834-1-1.html>谁的小店有WIN10专业版的激活码呀？ - hostloc</a></li><li><a href="https://www.ilanni.com/?p=7016">烂泥：KVM使用NAT联网并为VM配置iptables端口转发</a></li><li><a href=https://www.cnblogs.com/jinjiyese153/p/8600855.html>CentOS配置iptables规则并使其永久生效</a></li><li><a href=https://blog.csdn.net/weixin_41004350/article/details/80805927>Centos7 安装VNC实现远程桌面</a></li><li><a href=https://blog.csdn.net/haoxiaoyan/article/details/96859837>kvm调整配置cpu、内存</a></li></ul><div class=post-meta></hr>注：本作品采用<a rel=license target=view_window href=http://creativecommons.org/licenses/by-nc-sa/4.0/> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议 </a>进行许可。</div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.frytea.com/tags/kvm/>🏷 KVM</a></li></ul><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 裸金属服务器kvm虚拟化安装win10 on twitter" href="https://twitter.com/intent/tweet/?text=%e8%a3%b8%e9%87%91%e5%b1%9e%e6%9c%8d%e5%8a%a1%e5%99%a8kvm%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%89%e8%a3%85win10&url=https%3a%2f%2fwww.frytea.com%2farchives%2f261%2f&hashtags=KVM"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 裸金属服务器kvm虚拟化安装win10 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.frytea.com%2farchives%2f261%2f&title=%e8%a3%b8%e9%87%91%e5%b1%9e%e6%9c%8d%e5%8a%a1%e5%99%a8kvm%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%89%e8%a3%85win10&summary=%e8%a3%b8%e9%87%91%e5%b1%9e%e6%9c%8d%e5%8a%a1%e5%99%a8kvm%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%89%e8%a3%85win10&source=https%3a%2f%2fwww.frytea.com%2farchives%2f261%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 裸金属服务器kvm虚拟化安装win10 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.frytea.com%2farchives%2f261%2f&title=%e8%a3%b8%e9%87%91%e5%b1%9e%e6%9c%8d%e5%8a%a1%e5%99%a8kvm%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%89%e8%a3%85win10"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 裸金属服务器kvm虚拟化安装win10 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.frytea.com%2farchives%2f261%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 裸金属服务器kvm虚拟化安装win10 on whatsapp" href="https://api.whatsapp.com/send?text=%e8%a3%b8%e9%87%91%e5%b1%9e%e6%9c%8d%e5%8a%a1%e5%99%a8kvm%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%89%e8%a3%85win10%20-%20https%3a%2f%2fwww.frytea.com%2farchives%2f261%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 裸金属服务器kvm虚拟化安装win10 on telegram" href="https://telegram.me/share/url?text=%e8%a3%b8%e9%87%91%e5%b1%9e%e6%9c%8d%e5%8a%a1%e5%99%a8kvm%e8%99%9a%e6%8b%9f%e5%8c%96%e5%ae%89%e8%a3%85win10&url=https%3a%2f%2fwww.frytea.com%2farchives%2f261%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><nav class=paginav><a class=prev href=https://www.frytea.com/archives/262/><span class=title>« 上一页</span><br><span>kvm 虚拟化安装 Ubuntu 18.04 server</span></a>
<a class=next href=https://www.frytea.com/archives/260/><span class=title>下一页 »</span><br><span>【持续集成】Android使用Github Action自动打包并发布Fir.im内测</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=songtianlun/songtianlun.github.io data-repo-id=R_kgDOGQ9BVQ data-category=Announcements data-category-id=DIC_kwDOGQ9BVc4CX1qg data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright &copy; 2023 • <a href=https://www.frytea.com/>Frytea</a></span>
<span>• <a href=http://beian.miit.gov.cn/ target=view_window>粤 ICP 备 19144283 号</a></span><div><span><a href=/about/>关于</a>
• <a href=/disclaimer/>免责声明</a>
• <a href=/sitemap.xml target=view_window>站点地图</a>
• <a href=https://www.foreverblog.cn/go.html target=view_window>虫洞</a>
• PV <span id=busuanzi_value_site_pv><i class="fa fa-spinner fa-spin"></i></span></span></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><meta name=”apple-mobile-web-app-capable” content="”yes”"><script>'serviceWorker'in navigator&&window.addEventListener('load',()=>{navigator.serviceWorker.register('/service-worker.js')})</script></body></html>