<!doctype html><html lang=zh dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>【ZMQ】第一个C服务器 | Frytea</title><meta name=keywords content><meta name=description content="技术背景 ØMQ （也拼写作ZeroMQ，0MQ或ZMQ)，号称号称是“史上最快的消息队列”，基于c语言开发。ZMQ(以下ZeroMQ简称ZMQ"><meta name=author content="Tianlun Song"><link rel=canonical href=https://www.frytea.com/archives/335/><meta name=yandex-verification content="73b1a797f62c0e98"><meta name=baidu-site-verification content="code-gnOrbP1RyC"><meta name=baidu_union_verify content="4c552c344295cb984c46ebe74962b067"><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/satouriko/LxgwWenKai_Webfonts@v1.101/dist/LXGWWenKai-Light.css><link crossorigin=anonymous href=/assets/css/stylesheet.min.0a5d9aa21e56d0b7d41b1d4b56af0b911caf526faf5060a8d3717579bf27cb93.css integrity="sha256-Cl2aoh5W0LfUGx1LVq8LkRyvUm+vUGCo03F1eb8ny5M=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://www.frytea.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.frytea.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.frytea.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.frytea.com/apple-touch-icon.png><link rel=mask-icon href=https://www.frytea.com/apple-touch-icon.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.85.0"><link rel=manifest href=/manifest.json><script type=text/javascript>function downloadJSAtOnload(){var a=document.createElement("script");a.src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7296634171837358",document.body.appendChild(a)}window.addEventListener?window.addEventListener("load",downloadJSAtOnload,!1):window.attachEvent?window.attachEvent("onload",downloadJSAtOnload):window.onload=downloadJSAtOnload</script><script async defer data-website-id=3d947a98-2774-46b0-805f-fe2e4877a1d7 src=https://umami.frytea.com/umami.js></script><script async src=https://www.frytea.com/js/busuanzi.pure.mini.js></script><link rel=stylesheet href=/libs/font-awesome-4.7.0/css/font-awesome.min.css><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script src=https://www.frytea.com/js/mermaid.min.js crossorigin=anonymous></script><script>const config={startOnLoad:!0,theme:'forest',themeVariables:{lineColor:"#fafafa"},flowchart:{useMaxWidth:!1,htmlLabels:!0}};mermaid.initialize(config),window.onload=()=>{window.mermaid.init(void 0,document.querySelectorAll('.language-mermaid'))}</script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?c49e2f5be5e009382be07455c33b1394",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-136094326-1','auto'),ga('send','pageview'))</script><meta property="og:title" content="【ZMQ】第一个C服务器"><meta property="og:description" content="技术背景 ØMQ （也拼写作ZeroMQ，0MQ或ZMQ)，号称号称是“史上最快的消息队列”，基于c语言开发。ZMQ(以下ZeroMQ简称ZMQ"><meta property="og:type" content="article"><meta property="og:url" content="https://www.frytea.com/archives/335/"><meta property="og:image" content="https://www.frytea.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="archives"><meta property="article:published_time" content="2020-06-08T16:47:00+00:00"><meta property="article:modified_time" content="2020-06-08T16:47:00+00:00"><meta property="og:site_name" content="Frytea"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.frytea.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="【ZMQ】第一个C服务器"><meta name=twitter:description content="技术背景 ØMQ （也拼写作ZeroMQ，0MQ或ZMQ)，号称号称是“史上最快的消息队列”，基于c语言开发。ZMQ(以下ZeroMQ简称ZMQ"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Archives","item":"https://www.frytea.com/archives/"},{"@type":"ListItem","position":2,"name":"【ZMQ】第一个C服务器","item":"https://www.frytea.com/archives/335/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"【ZMQ】第一个C服务器","name":"【ZMQ】第一个C服务器","description":"技术背景 ØMQ （也拼写作ZeroMQ，0MQ或ZMQ)，号称号称是“史上最快的消息队列”，基于c语言开发。ZMQ(以下ZeroMQ简称ZMQ","keywords":[],"articleBody":"技术背景 ØMQ （也拼写作ZeroMQ，0MQ或ZMQ)，号称号称是“史上最快的消息队列”，基于c语言开发。ZMQ(以下ZeroMQ简称ZMQ)是一个简单好用的传输层，像框架一样的一个socket library，他使得Socket编程更加简单、简洁和性能更高。是一个消息处理队列库，可在多个线程、内核和主机盒之间弹性伸缩。\n作为C开发人员有两个选择 CZMQ 或 libzmq （低级zeromq库）。\n在这里简单记录 CentOS 下从零安装ZMQ相关依赖、解决各种问题最终实现一个最简单的请求-应答服务器-客户端效果。\nZeroMQ 在 centos下的安装 1）下载ZeroMQ\n执行命令：\nwget http://download.zeromq.org/zeromq-4.0.4.tar.gz\r2）解压ZeroMQ\n$ tar zvxf zeromq-4.0.4.tar.gz\r$ mv zeromq-4.0.4 zeromq\r$ cd zeromq\r3）安装依赖\n$ yum install libtool\r$ ./autogen.sh 4）编译安装\n$ ./configure\r......\rchecking for gcc... no\rchecking for cc... no\rchecking for cl.exe... no\rconfigure: error: in `/home/chuser/zeromq':\rconfigure: error: no acceptable C compiler found in $PATH\rSee `config.log' for more details\r提示缺少C编译器，先安装GCC。\n$ sudo yum install gcc\r安装OK！再次执行\n$ ./configure\r......\rchecking whether the C++ compiler works... no\rconfigure: error: Unable to find a working C++ compiler\r提示缺少C++编译器，先安装G++。\n$ sudo yum install gcc-c++ 安装OK！再次执行\n$ ./configure\r$ make\r$ sudo make install\rZeroMQ安装成功！\nlibzmq 在 CentOS 下的安装 libzmq开源仓库： https://github.com/zeromq/libzmq\n# 对于 CentOS 8，请以根用户 root 运行下面命令：\rcd /etc/yum.repos.d/\rwget https://download.opensuse.org/repositories/network:messaging:zeromq:release-stable/CentOS_8/network:messaging:zeromq:release-stable.repo\ryum install zeromq-devel\r# 对于 CentOS 7，请以根用户 root 运行下面命令：\rcd /etc/yum.repos.d/\rwget https://download.opensuse.org/repositories/network:messaging:zeromq:release-stable/CentOS_7/network:messaging:zeromq:release-stable.repo\ryum install zeromq-devel\r# 对于 CentOS 6，请以根用户 root 运行下面命令：\rcd /etc/yum.repos.d/\rwget https://download.opensuse.org/repositories/network:messaging:zeromq:release-stable/CentOS_6/network:messaging:zeromq:release-stable.repo\ryum install zeromq-devel\rDemo (来源:https://zeromq.org/languages/c/#libzmq)\nServer:\n#include #include #include #include #include  int main (void) { // Socket to talk to clients  void *context = zmq_ctx_new (); void *responder = zmq_socket (context, ZMQ_REP); int rc = zmq_bind (responder, \"tcp://*:5555\"); assert (rc == 0); while (1) { char buffer [10]; zmq_recv (responder, buffer, 10, 0); printf (\"Received Hello\\n\"); sleep (1); // Do some 'work'  zmq_send (responder, \"World\", 5, 0); } return 0; } Client:\nCopy #include #include #include #include  int main (void) { printf (\"Connecting to hello world server…\\n\"); void *context = zmq_ctx_new (); void *requester = zmq_socket (context, ZMQ_REQ); zmq_connect (requester, \"tcp://localhost:5555\"); int request_nbr; for (request_nbr = 0; request_nbr != 10; request_nbr++) { char buffer [10]; printf (\"Sending Hello %d…\\n\", request_nbr); zmq_send (requester, \"Hello\", 5, 0); zmq_recv (requester, buffer, 10, 0); printf (\"Received World %d\\n\", request_nbr); } zmq_close (requester); zmq_ctx_destroy (context); return 0; } 将文件存入以libzmq_server.c，libzmq_client.c命名的文件。\n运行下列命令编译：\ngcc libzmq_server.c -o libzmq_server -lzmq\rgcc libzmq_client.c -o libzmq_client -lzmq\r若出现错误，请移步异常问题记录区寻找答案\n分别在两个终端运行，若成功，效果如下：\n$ ./libzmq_server\rReceived Hello\rReceived Hello\rReceived Hello\rReceived Hello\rReceived Hello\rReceived Hello\rReceived Hello\rReceived Hello\rReceived Hello\rReceived Hello\r$ ./libzmq_client\rConnecting to hello world server…\rSending Hello 0…\rReceived World 0\rSending Hello 1…\rReceived World 1\rSending Hello 2…\rReceived World 2\rSending Hello 3…\rReceived World 3\rSending Hello 4…\rReceived World 4\rSending Hello 5…\rReceived World 5\rSending Hello 6…\rReceived World 6\rSending Hello 7…\rReceived World 7\rSending Hello 8…\rReceived World 8\rSending Hello 9…\rReceived World 9\r异常记录 undefined reference to `zmq_sendmsg' 解决方案: 编译时带上 -lzmq\n例如：gcc -o hello hello.c -lzmq\nerror while loading shared libraries: libzmq.so.3 方法1：\n找一下动态文件安装到哪里了：\n$ whereis libzmq.so.3\r$ find / -name libzmq.so.3\r将 /usr/local/lib 加到共享库配置文件 /etc/ld.so.conf 中，该方法一劳永逸，但是需要有操作权限\n# cat /etc/ld.so.conf\rinclude ld.so.conf.d/*.conf\r# echo \"/usr/local/lib\"/etc/ld.so.conf\r# ldconfig\r再执行成功.\n方法2：设置环境变量LD_LIBRARY_PATH，适合没有操作权限时使用\n# vi ~/.bash_profile 编辑你当前用户的用户目录下的.bash_profile文件 在文件后面加上：\nexport LD_LIBRARY_PATH=/usr/local/lib/:$LD_LIBRARY_PATH\r保存并关闭文件\n# source ~/.bash_profile 使该文件改动生效（每次登录该用户时也会自动加载该文件，使文件生效） 执行成功\nC程序头文件引用问题 一直没有搞清楚头文件引用 \"\" 和  的区别，今天偶然查到：\n first：include 引用系统头文件一般用。 second：include\"fileName.h\" 引用自己定义的头文件一般用\" “。  区别是首先去系统中去找，” “则在自己当前文件夹找。\n一般情况下系统头文件在 usr/include/中。\n参考文献  ZMQ 官方指南 ZMQ 指南汉化版 ZMQ - C语言 Wikipedia/ZeroMQ 浅析ZeroMQ 【Linux】ZeroMQ 在 centos下的安装 安装zeroMQ以及error while loading shared librarie找不多对应so文件的错误解决 c – g未定义的对ZMQ的引用 C语言头文件引用 Linux下C语言的系统头文件  ","wordCount":"1535","inLanguage":"zh","datePublished":"2020-06-08T16:47:00Z","dateModified":"2020-06-08T16:47:00Z","author":{"@type":"Person","name":"Tianlun Song"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.frytea.com/archives/335/"},"publisher":{"@type":"Organization","name":"Frytea","logo":{"@type":"ImageObject","url":"https://www.frytea.com/favicon.ico"}}}</script></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><header class=header><nav class=nav><div class=logo><a href=https://www.frytea.com/ accesskey=h title="🏡 Frytea (Alt + H)">🏡 Frytea</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://www.frytea.com/tags/ title="🏷️ 标签"><span>🏷️ 标签</span></a></li><li><a href=https://www.frytea.com/search/ title="🔍 索引 (Alt + /)" accesskey=/><span>🔍 索引</span></a></li><li><a href=https://www.frytea.com/friends title="🧑‍🤝‍🧑 友链"><span>🧑‍🤝‍🧑 友链</span></a></li><li><a href=https://www.travellings.cn/go.html title=🚇><span>🚇</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.frytea.com/>主页</a>&nbsp;»&nbsp;<a href=https://www.frytea.com/archives/>Archives</a></div><h1 class=post-title><a href=https://www.frytea.com/archives/335/>【ZMQ】第一个C服务器</a></h1><div class=post-meta>June 8, 2020&nbsp;·&nbsp;4 分钟&nbsp;·&nbsp;1535 字&nbsp;·&nbsp;Tianlun Song&nbsp;|&nbsp;<a href=https://github.com/songtianlun/songtianlun.github.io/edit/main/content/archives/%e3%80%90ZMQ%e3%80%91%e7%ac%ac%e4%b8%80%e4%b8%aaC%e6%9c%8d%e5%8a%a1%e5%99%a8.md rel="noopener noreferrer" target=_blank>PR</a>
<span>| <span class=waline-pageview-count data-path=/archives/335/><i class="fa fa-spinner fa-spin"></i></span> Hits</span></div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>目录</span></summary><div class=inner><ul><li><a href=#%e6%8a%80%e6%9c%af%e8%83%8c%e6%99%af aria-label=技术背景>技术背景</a></li><li><a href=#zeromq-%e5%9c%a8-centos%e4%b8%8b%e7%9a%84%e5%ae%89%e8%a3%85 aria-label="ZeroMQ 在 centos下的安装">ZeroMQ 在 centos下的安装</a></li><li><a href=#libzmq-%e5%9c%a8-centos-%e4%b8%8b%e7%9a%84%e5%ae%89%e8%a3%85 aria-label="libzmq 在 CentOS 下的安装">libzmq 在 <code>CentOS</code> 下的安装</a></li><li><a href=#demo aria-label=Demo>Demo</a></li><li><a href=#%e5%bc%82%e5%b8%b8%e8%ae%b0%e5%bd%95 aria-label=异常记录>异常记录</a><ul><li><a href=#undefined-reference-to-zmq_sendmsg aria-label="undefined reference to `zmq_sendmsg'">undefined reference to `zmq_sendmsg'</a></li><li><a href=#error-while-loading-shared-libraries-libzmqso3 aria-label="error while loading shared libraries: libzmq.so.3">error while loading shared libraries: libzmq.so.3</a></li><li><a href=#c%e7%a8%8b%e5%ba%8f%e5%a4%b4%e6%96%87%e4%bb%b6%e5%bc%95%e7%94%a8%e9%97%ae%e9%a2%98 aria-label=C程序头文件引用问题>C程序头文件引用问题</a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83%e6%96%87%e7%8c%ae aria-label=参考文献>参考文献</a></li></ul></div><div><ins class=adsbygoogle style=display:block data-ad-client=ca-pub-7296634171837358 data-ad-slot=9161921641 data-ad-format=auto data-full-width-responsive=true></ins></div><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script></details></div><div class=post-content><blockquote style=margin-top:8px><p style=text-align:center;text-indent:0><a href=https://www.frytea.com/archives/335/>本文</a>
首发于
<a href=https://www.frytea.com/>🌱 煎茶</a>，
<a href=/disclaimer/>转载</a> 请注明
<a href=https://www.frytea.com/archives/335/>来源</a>。</p></blockquote><h2 id=技术背景>技术背景<a hidden class=anchor aria-hidden=true href=#技术背景>#</a></h2><p>ØMQ （也拼写作ZeroMQ，0MQ或ZMQ)，号称号称是“史上最快的消息队列”，基于c语言开发。ZMQ(以下ZeroMQ简称ZMQ)是一个简单好用的传输层，像框架一样的一个socket library，他使得Socket编程更加简单、简洁和性能更高。是一个消息处理队列库，可在多个线程、内核和主机盒之间弹性伸缩。</p><p>作为C开发人员有两个选择 <a href=https://zeromq.org/languages/c/#czmq>CZMQ</a> 或 <a href=https://zeromq.org/languages/c/#libzmq>libzmq</a> （低级zeromq库）。</p><p>在这里简单记录 <code>CentOS</code> 下从零安装ZMQ相关依赖、解决各种问题最终实现一个最简单的请求-应答服务器-客户端效果。</p><h2 id=zeromq-在-centos下的安装>ZeroMQ 在 centos下的安装<a hidden class=anchor aria-hidden=true href=#zeromq-在-centos下的安装>#</a></h2><p>1）下载ZeroMQ</p><p>执行命令：</p><pre><code>wget http://download.zeromq.org/zeromq-4.0.4.tar.gz
</code></pre><p>2）解压ZeroMQ</p><pre><code>$ tar zvxf zeromq-4.0.4.tar.gz
$ mv zeromq-4.0.4 zeromq
$ cd zeromq
</code></pre><p>3）安装依赖</p><pre><code>$ yum install libtool
$ ./autogen.sh 
</code></pre><p>4）编译安装</p><pre><code>$ ./configure
......
checking for gcc... no
checking for cc... no
checking for cl.exe... no
configure: error: in `/home/chuser/zeromq':
configure: error: no acceptable C compiler found in $PATH
See `config.log' for more details
</code></pre><p>提示缺少C编译器，先安装<code>GCC</code>。</p><pre><code>$ sudo yum install gcc
</code></pre><p>安装OK！再次执行</p><pre><code>$ ./configure
......
checking whether the C++ compiler works... no
configure: error: Unable to find a working C++ compiler
</code></pre><p>提示缺少C++编译器，先安装G++。</p><pre><code>$ sudo yum install gcc-c++ 
</code></pre><p>安装OK！再次执行</p><pre><code>$ ./configure
$ make
$ sudo make install
</code></pre><p>ZeroMQ安装成功！</p><h2 id=libzmq-在-centos-下的安装>libzmq 在 <code>CentOS</code> 下的安装<a hidden class=anchor aria-hidden=true href=#libzmq-在-centos-下的安装>#</a></h2><p>libzmq开源仓库： <a href=https://github.com/zeromq/libzmq>https://github.com/zeromq/libzmq</a></p><pre><code># 对于 CentOS 8，请以根用户 root 运行下面命令：
cd /etc/yum.repos.d/
wget https://download.opensuse.org/repositories/network:messaging:zeromq:release-stable/CentOS_8/network:messaging:zeromq:release-stable.repo
yum install zeromq-devel

# 对于 CentOS 7，请以根用户 root 运行下面命令：
cd /etc/yum.repos.d/
wget https://download.opensuse.org/repositories/network:messaging:zeromq:release-stable/CentOS_7/network:messaging:zeromq:release-stable.repo
yum install zeromq-devel

# 对于 CentOS 6，请以根用户 root 运行下面命令：
cd /etc/yum.repos.d/
wget https://download.opensuse.org/repositories/network:messaging:zeromq:release-stable/CentOS_6/network:messaging:zeromq:release-stable.repo
yum install zeromq-devel
</code></pre><h2 id=demo>Demo<a hidden class=anchor aria-hidden=true href=#demo>#</a></h2><p>(来源:https://zeromq.org/languages/c/#libzmq)</p><p>Server:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;zmq.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;assert.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span> (<span style=color:#66d9ef>void</span>)
{
    <span style=color:#75715e>//  Socket to talk to clients
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>context <span style=color:#f92672>=</span> zmq_ctx_new ();
    <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>responder <span style=color:#f92672>=</span> zmq_socket (context, ZMQ_REP);
    <span style=color:#66d9ef>int</span> rc <span style=color:#f92672>=</span> zmq_bind (responder, <span style=color:#e6db74>&#34;tcp://*:5555&#34;</span>);
    assert (rc <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>);

    <span style=color:#66d9ef>while</span> (<span style=color:#ae81ff>1</span>) {
        <span style=color:#66d9ef>char</span> buffer [<span style=color:#ae81ff>10</span>];
        zmq_recv (responder, buffer, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>0</span>);
        printf (<span style=color:#e6db74>&#34;Received Hello</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
        sleep (<span style=color:#ae81ff>1</span>);          <span style=color:#75715e>//  Do some &#39;work&#39;
</span><span style=color:#75715e></span>        zmq_send (responder, <span style=color:#e6db74>&#34;World&#34;</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>);
    }
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><p>Client:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c>Copy
<span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;zmq.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;string.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;unistd.h&gt;</span><span style=color:#75715e>
</span><span style=color:#75715e></span>
<span style=color:#66d9ef>int</span> main (<span style=color:#66d9ef>void</span>)
{
    printf (<span style=color:#e6db74>&#34;Connecting to hello world server…</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
    <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>context <span style=color:#f92672>=</span> zmq_ctx_new ();
    <span style=color:#66d9ef>void</span> <span style=color:#f92672>*</span>requester <span style=color:#f92672>=</span> zmq_socket (context, ZMQ_REQ);
    zmq_connect (requester, <span style=color:#e6db74>&#34;tcp://localhost:5555&#34;</span>);

    <span style=color:#66d9ef>int</span> request_nbr;
    <span style=color:#66d9ef>for</span> (request_nbr <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; request_nbr <span style=color:#f92672>!=</span> <span style=color:#ae81ff>10</span>; request_nbr<span style=color:#f92672>++</span>) {
        <span style=color:#66d9ef>char</span> buffer [<span style=color:#ae81ff>10</span>];
        printf (<span style=color:#e6db74>&#34;Sending Hello %d…</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, request_nbr);
        zmq_send (requester, <span style=color:#e6db74>&#34;Hello&#34;</span>, <span style=color:#ae81ff>5</span>, <span style=color:#ae81ff>0</span>);
        zmq_recv (requester, buffer, <span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>0</span>);
        printf (<span style=color:#e6db74>&#34;Received World %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, request_nbr);
    }
    zmq_close (requester);
    zmq_ctx_destroy (context);
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
}
</code></pre></div><p>将文件存入以<code>libzmq_server.c</code>，<code>libzmq_client.c</code>命名的文件。</p><p>运行下列命令编译：</p><pre><code>gcc libzmq_server.c -o libzmq_server -lzmq
gcc libzmq_client.c -o libzmq_client -lzmq
</code></pre><p>若出现错误，请移步异常问题记录区寻找答案</p><p>分别在两个终端运行，若成功，效果如下：</p><pre><code>$ ./libzmq_server
Received Hello
Received Hello
Received Hello
Received Hello
Received Hello
Received Hello
Received Hello
Received Hello
Received Hello
Received Hello
</code></pre><pre><code>$ ./libzmq_client
Connecting to hello world server…
Sending Hello 0…
Received World 0
Sending Hello 1…
Received World 1
Sending Hello 2…
Received World 2
Sending Hello 3…
Received World 3
Sending Hello 4…
Received World 4
Sending Hello 5…
Received World 5
Sending Hello 6…
Received World 6
Sending Hello 7…
Received World 7
Sending Hello 8…
Received World 8
Sending Hello 9…
Received World 9
</code></pre><h2 id=异常记录>异常记录<a hidden class=anchor aria-hidden=true href=#异常记录>#</a></h2><h3 id=undefined-reference-to-zmq_sendmsg>undefined reference to `zmq_sendmsg'<a hidden class=anchor aria-hidden=true href=#undefined-reference-to-zmq_sendmsg>#</a></h3><p>解决方案:
编译时带上 <code>-lzmq</code></p><p>例如：<code>gcc -o hello hello.c -lzmq</code></p><h3 id=error-while-loading-shared-libraries-libzmqso3>error while loading shared libraries: libzmq.so.3<a hidden class=anchor aria-hidden=true href=#error-while-loading-shared-libraries-libzmqso3>#</a></h3><p>方法1：</p><p>找一下动态文件安装到哪里了：</p><pre><code>$ whereis libzmq.so.3

$ find / -name libzmq.so.3
</code></pre><p>将 <code>/usr/local/lib</code> 加到共享库配置文件 <code>/etc/ld.so.conf</code> 中，该方法一劳永逸，但是需要有操作权限</p><pre><code># cat /etc/ld.so.conf
include ld.so.conf.d/*.conf
# echo &quot;/usr/local/lib&quot;&gt;&gt;/etc/ld.so.conf
# ldconfig
</code></pre><p>再执行成功.</p><p>方法2：设置环境变量LD_LIBRARY_PATH，适合没有操作权限时使用</p><pre><code># vi ~/.bash_profile 
</code></pre><p>编辑你当前用户的用户目录下的.bash_profile文件
在文件后面加上：</p><pre><code>export LD_LIBRARY_PATH=/usr/local/lib/:$LD_LIBRARY_PATH
</code></pre><p>保存并关闭文件</p><pre><code># source ~/.bash_profile 
</code></pre><p>使该文件改动生效（每次登录该用户时也会自动加载该文件，使文件生效）
执行成功</p><h3 id=c程序头文件引用问题>C程序头文件引用问题<a hidden class=anchor aria-hidden=true href=#c程序头文件引用问题>#</a></h3><p>一直没有搞清楚头文件引用 "" 和 &lt;> 的区别，今天偶然查到：</p><ul><li>first：include&lt;fileName.h> 引用系统头文件一般用&lt;>。</li><li>second：include"fileName.h" 引用自己定义的头文件一般用" &ldquo;。</li></ul><p>区别是&lt;>首先去系统中去找，&rdquo; &ldquo;则在自己当前文件夹找。</p><p>一般情况下系统头文件在 <code>usr/include/</code>中。</p><h2 id=参考文献>参考文献<a hidden class=anchor aria-hidden=true href=#参考文献>#</a></h2><ul><li><a href=http://zguide.zeromq.org/page:all>ZMQ 官方指南</a></li><li><a href=https://github.com/anjuke/zguide-cn>ZMQ 指南汉化版</a></li><li><a href=https://zeromq.org/languages/c/#libzmq>ZMQ - C语言</a></li><li><a href=https://zh.wikipedia.org/wiki/%C3%98MQ>Wikipedia/ZeroMQ</a></li><li><a href=https://blog.csdn.net/weixin_40685388/article/details/81197552>浅析ZeroMQ</a></li><li><a href=https://www.cnblogs.com/wangzhongqiu/p/6542892.html>【Linux】ZeroMQ 在 centos下的安装</a></li><li><a href="https://blog.csdn.net/tomorrowmorningj/article/details/66982261?utm_source=blogxgwz7">安装zeroMQ以及error while loading shared librarie找不多对应so文件的错误解决</a></li><li><a href=http://www.6tie.net/p/1082504.html>c – g未定义的对ZMQ的引用</a></li><li><a href=https://www.cnblogs.com/blueberry006/p/7830883.html>C语言头文件引用</a></li><li><a href=https://blog.csdn.net/weixin_30872671/article/details/97592203>Linux下C语言的系统头文件</a></li></ul><div class=post-meta></hr>注：本作品采用<a rel=license target=view_window href=http://creativecommons.org/licenses/by-nc-sa/4.0/> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议 </a>进行许可。</div></div><footer class=post-footer><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 【ZMQ】第一个C服务器 on twitter" href="https://twitter.com/intent/tweet/?text=%e3%80%90ZMQ%e3%80%91%e7%ac%ac%e4%b8%80%e4%b8%aaC%e6%9c%8d%e5%8a%a1%e5%99%a8&url=https%3a%2f%2fwww.frytea.com%2farchives%2f335%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【ZMQ】第一个C服务器 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.frytea.com%2farchives%2f335%2f&title=%e3%80%90ZMQ%e3%80%91%e7%ac%ac%e4%b8%80%e4%b8%aaC%e6%9c%8d%e5%8a%a1%e5%99%a8&summary=%e3%80%90ZMQ%e3%80%91%e7%ac%ac%e4%b8%80%e4%b8%aaC%e6%9c%8d%e5%8a%a1%e5%99%a8&source=https%3a%2f%2fwww.frytea.com%2farchives%2f335%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【ZMQ】第一个C服务器 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.frytea.com%2farchives%2f335%2f&title=%e3%80%90ZMQ%e3%80%91%e7%ac%ac%e4%b8%80%e4%b8%aaC%e6%9c%8d%e5%8a%a1%e5%99%a8"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【ZMQ】第一个C服务器 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.frytea.com%2farchives%2f335%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【ZMQ】第一个C服务器 on whatsapp" href="https://api.whatsapp.com/send?text=%e3%80%90ZMQ%e3%80%91%e7%ac%ac%e4%b8%80%e4%b8%aaC%e6%9c%8d%e5%8a%a1%e5%99%a8%20-%20https%3a%2f%2fwww.frytea.com%2farchives%2f335%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 【ZMQ】第一个C服务器 on telegram" href="https://telegram.me/share/url?text=%e3%80%90ZMQ%e3%80%91%e7%ac%ac%e4%b8%80%e4%b8%aaC%e6%9c%8d%e5%8a%a1%e5%99%a8&url=https%3a%2f%2fwww.frytea.com%2farchives%2f335%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div><nav class=paginav><a class=prev href=https://www.frytea.com/archives/337/><span class=title>« 上一页</span><br><span>解决Windows下帮助文件打开空白</span></a>
<a class=next href=https://www.frytea.com/archives/325/><span class=title>下一页 »</span><br><span>Minecraft 从安装到入门</span></a></nav></footer><script src=https://giscus.app/client.js data-repo=songtianlun/songtianlun.github.io data-repo-id=R_kgDOGQ9BVQ data-category=Announcements data-category-id=DIC_kwDOGQ9BVc4CX1qg data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script></article></main><footer class=footer><span>Copyright &copy; 2023 • <a href=https://www.frytea.com/>Frytea</a></span>
<span>• <a href=http://beian.miit.gov.cn/ target=view_window>粤 ICP 备 19144283 号</a></span><div><span><a href=/about/>关于</a>
• <a href=/disclaimer/>免责声明</a>
• <a href=/sitemap.xml target=view_window>站点地图</a>
• <a href=https://www.foreverblog.cn/go.html target=view_window>虫洞</a>
• PV <span id=busuanzi_value_site_pv><i class="fa fa-spinner fa-spin"></i></span></span></div></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script><meta name=”apple-mobile-web-app-capable” content="”yes”"><script>'serviceWorker'in navigator&&window.addEventListener('load',()=>{navigator.serviceWorker.register('/service-worker.js')})</script></body></html>