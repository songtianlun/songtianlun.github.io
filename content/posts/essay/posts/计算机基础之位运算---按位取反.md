---
title: "计算机基础之位运算 | 按位取反"
categories: [ "技术价值" ]
tags: [  ]
draft: false
slug: "424"
date: "2020-08-06 19:25:00"
---

程序中的所有数在计算机内存中都是以二进制的形式储存的。位操作是程序设计中对位模式或二进制数的一元和二元操作。在许多古老的微处理器上，位运算比加减运算略快，通常位运算比乘除法运算要快很多。在现代架构中，情况并非如此：位运算的运算速度通常与加法运算相同（仍然快于乘法运算）。（摘自维基百科）

位运算对CPU很友好，是一种程序优化手段，也是大厂面试中常常会提及的话题。在日常的编程中用到为运算，也是可以实现许多有趣的事情的。作为一名计算机相关专业的毕业生，居然到现在还没有用过位运算，简直是耻辱。于是最近恶补相关知识，在此简单记录。

位运算符包括取反、按位或、按位异或、按位与；对于比特位还可以进行移位，左移运算，向左进行移位操作，高位丢弃，低位补 0；右移运算，向右进行移位操作，对无符号数，高位补 0，对于有符号数，高位补符号位。

众所周知，在 `C/C++` 中一个 `char`  类型的变量在内存中占据1个字节，即8比特，其实每一个比特位都可以当作一个开关来用，以此来做标志位等。

## 基础位运算符

下面记录一下各种位运算符操作：

- `&` 与运算 两个位都是 1 时，结果才为 1，否则为 0，如

```bash
  1 0 0 1 1
& 1 1 0 0 1
------------------------------
  1 0 0 0 1
```

- `|`  或运算 两个位都是 0 时，结果才为 0，否则为 1，如

```bash
  1 0 0 1 1
| 1 1 0 0 1
------------------------------
  1 1 0 1 1
```

- `^`  异或运算，两个位相同则为 0，不同则为 1，如

```bash
  1 0 0 1 1
^ 1 1 0 0 1
-----------------------------
  0 1 0 1 0
```

- `~` 取反运算，0 则变为 1，1 则变为 0，如

```bash
~ 1 0 0 1 1
-----------------------------
  0 1 1 0 0
```

- `<<` 左移运算，向左进行移位操作，高位丢弃，低位补 0，如

```bash
int a = 8;
a << 3;
移位前：0000 0000 0000 0000 0000 0000 0000 1000
移位后：0000 0000 0000 0000 0000 0000 0100 0000
```

- `>>` 右移运算，向右进行移位操作，对无符号数，高位补 0，对于有符号数，高位补符号位，如

```bash
unsigned int a = 8;
a >> 3;
移位前：0000 0000 0000 0000 0000 0000 0000 1000
移位后：0000 0000 0000 0000 0000 0000 0000 0001

int a = -8;
a >> 3;
移位前：1111 1111 1111 1111 1111 1111 1111 1000
移位前：1111 1111 1111 1111 1111 1111 1111 1111
```

以上展示的是位操作中的基本运算符，使用这些基本运算、利用二进制一些性质可以实现诸如快速乘除法、交换两数、判断奇偶、求绝对值、高低位交换、逆序、快速统计1的个数等操作。

以统计二进制中1的个数为例，计算 34520 二进制中的1个数：

我们计算其 `a &= (a-1)` 的结果：

- 第一次：计算前： `1000 0110 1101 1000`  计算后： `1000 0110 1101 0000`
- 第二次：计算前： `1000 0110 1101 0000` 计算后： `1000 0110 1100 0000`
- 第二次：计算前： `1000 0110 1100 0000` 计算后： `1000 0110 1000 0000`

容易发现，每计算一次二进制中就少了一个 1，则我们可以通过下面方法去统计：

```cpp
count = 0  
while(a){  
  a = a & (a - 1);  
  count++;  
}
```

容易发现，善用位运算可以极大提高运算效率，由于计算机中存储和处理都是采用二进制，因此位运算也是很符合计算机处理逻辑的。

## 按位取反

除了以上计算，还有一种按位取反计算，下面简单记录：

在进行按位取反之前，首先需要了解一下原码、补码、反码、取反。

- 原码：
    - 正数是其二进制本身；
    - 负数是符号位为1,数值部分取X绝对值的二进制。
- 反码：
    - 正数的反码和原码相同；
    - 负数是符号位为1,其它位是原码取反。
- 补码：
    - 正数的补码和原码，反码相同；
    - 负数是符号位为1，其它位是原码取反，未位加1。（反码末尾减1）（或者说负数的补码是其绝对值反码未位加1）
- 取反就是简单的 `0变1,1变0` ；

而按位取反需要涉及以上概念。要弄懂这个运算符的计算方法，首先必须明白二进制数在内存中的存放形式，二进制数在内存中是以补码的形式存放的。

下面以计算正数 9 的按位取反为例，计算步骤如下（注：前四位为符号位）：

```cpp
- 原码   : 0000 1001
- 算反码 : 0000 1001 （正数反码同原码）
- 算补码 : 0000 1001 （正数补码同反码）
- 补取反 : 1111 0110 （全位0变1，1变0）
- 算反码 : 1111 0101 （末位减1）
- 算原码 : 1111 1010 （其他位取反）
```

总结规律： `~x = -(x+1)`

针对按位取反的总结到此结束，但是按位取反的用途，目前博主知识有限，欢迎大家补充！

按位取反和取反的区别：

> 在c语言中
`!` 代表逻辑取反，即把所有非0的数值（相当于1）变为0，0变为1;
`~` 表示按位取反，即在数值的二进制表示方式上,将0变为1，将1变为0；

## 参考文献

- [位运算 - 百度百科](https://baike.baidu.com/item/%E4%BD%8D%E8%BF%90%E7%AE%97)
- [位操作 - 维基百科](https://zh.wikipedia.org/wiki/%E4%BD%8D%E6%93%8D%E4%BD%9C)
- [《算法心得：高效算法的奥秘 (Hacker's Delight)》——小亨利·S·沃伦（Henry S. Warren，Jr.）](https://doc.lagout.org/security/Hackers%20Delight.pdf)
- [关于位运算看这个就够了](https://blog.csdn.net/fengyelengfeng/article/details/43764819)
- [C语言位操作中指定的某一位数置0、置1、取反](https://blog.csdn.net/qq_37858386/article/details/78419911)
- [负数的二进制表示](https://www.jianshu.com/p/6c518e7b4690)
- [原码, 反码, 补码 详解](https://www.cnblogs.com/zhangziqiu/archive/2011/03/30/computercode.html)
- [C/C++ 数据范围int](https://www.cnblogs.com/bingcaihuang/archive/2011/07/14/2105959.html)
- [取反！和按位取反~的区别](https://blog.csdn.net/pipisorry/article/details/36517411)
- [按位取反运计算方法](https://blog.csdn.net/xiexievv/article/details/8124108)
- [位运算有什么奇技淫巧？](https://www.zhihu.com/question/38206659)
- [按位取反运算:int a=16,c=~a;,变量c的值为多少??](https://zhidao.baidu.com/question/57525952.html)
- [原码、反码、补码和移码详解](https://www.jianshu.com/p/abbdae4f3841)
- [Python学习中的“按位取反”笔记总结](https://my.oschina.net/u/4392184/blog/3242121)
- [!和~的区别(逻辑取反和按位取反)](https://blog.csdn.net/wuli_dear_wang/article/details/86377868)：[https://blog.csdn.net/wuli_dear_wang/article/details/86377868](https://blog.csdn.net/wuli_dear_wang/article/details/86377868)