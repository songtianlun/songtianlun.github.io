---
title: "Makefile基础语法"
categories: [ "编程开发" ]
tags: [  ]
draft: false
slug: "465"
date: "2020-10-14 22:53:18"
---

`Makefile` 是描述文件依赖关系的说明，由若干个规则组成，每个 **规则** 的格式如下：

```bash
目标：依赖关系
<tab键> 命令
```

其中：

- **目标** 是指 `make` 最终要创造的产物，也是 `make` 执行的动作名称，例如 `clean` ；
- **依赖关系** 是指编译目标体需要依赖的一个或多个文件列表；
- **命令** 是指为了从依赖文件创造目标文件所需执行的命令。

`make` 执行的动作也是一个目标，为避免该目标和文件目标冲突，可以使用以下格式将动作指定伪目标：

```makefile
.PHONY: clean
clean:
        rm *.o temp
```

在使用时，在具有 `Makefile` 文件的项目目录下通过如下命令运行：

```bash
$ make [target]
```

其中的参数 target 是指要处理的目标名，不指定则默认为 `make all` 。除了 `Makefile` ，还可将文件命名为 `GNUmakefile`, `makefile` ，命令执行时按照 `GNUmakefile`，`Makefile`， `makefile` 的顺序搜索 `Makefile` 文件。

## 预定义变量

为使命令编写更快捷，免去无意义的重复操作，有一些预定义变量可以用于简化 `Makefile` 。

```makefile
$@    # 规则目标对应的文件名
$*    # 不包含扩展名的目标文件名称
$+    # 所有的依赖文件，用空格分开，可能包含重复
$%    # 如果目标是归档成员，则该变量标识目标的归档成员名称
$<    # 规则中第一个依赖文件名
$^    # 规则中所有依赖的列表，空格分隔
$?    # 规则中日期新于目标的所有依赖文件的列表，空格分隔
$(@D) # 目标文件的目录部分
$(@F) # 目标文件的文件名部分
```